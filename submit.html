<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Kirim Reels</title>
<style>
body{margin:0;background:#0f172a;font-family:Arial;color:white;display:flex;justify-content:center;align-items:center;height:100vh}
.box{background:#020617;padding:25px;border-radius:14px;width:360px;text-align:center}
input{width:100%;padding:12px;border-radius:8px;border:0;margin-top:10px}
.btn{display:block;background:#38BFB3;color:#022c22;text-decoration:none;padding:12px;border-radius:8px;margin-top:12px;font-weight:bold}
</style>
</head>
<body>

<div class="box">
<h2>Kirim Reels Kamu</h2>
<input id="link" placeholder="Tempel link Reels Facebook">
<button class="btn" onclick="submitReels()">KIRIM</button>
</div>

<script>
if(localStorage.getItem("validated")!=="yes"){
 location.href="index.html";
}

function normalizeReel(url){
 try{
  const u = new URL(url);

  // fb.watch/xxxxx
  if(u.hostname.includes("fb.watch")){
    return "https://www.facebook.com/watch/?v=" + u.pathname.replace("/","");
  }

  // facebook.com/share/v/xxxx
  if(u.pathname.includes("/share/")){
    const id = u.pathname.split("/").pop();
    return "https://www.facebook.com/watch/?v=" + id;
  }

  // facebook.com/reel/xxxx
  if(u.pathname.includes("/reel/")){
    return "https://www.facebook.com" + u.pathname;
  }

  return url;
 }catch(e){
  return url;
 }
}

function submitReels(){
 const raw = document.getElementById("link").value.trim();
 if(!raw.includes("facebook")){ alert("Link tidak valid"); return; }

 const clean = normalizeReel(raw);

 const reels = JSON.parse(localStorage.getItem("reels")||"[]");
 reels.push(clean);
 localStorage.setItem("reels",JSON.stringify(reels));

 alert("Reels kamu siap diputar!");
 localStorage.removeItem("access_token");
 location.href="watch.html";
}
</script>
